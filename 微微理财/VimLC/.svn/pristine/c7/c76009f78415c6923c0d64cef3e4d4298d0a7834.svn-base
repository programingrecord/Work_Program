//
//  MSUProgramDetailView.m
//  VimLC
//
//  Created by 007 on 2018/1/15.
//  Copyright © 2018年 HM. All rights reserved.
//

#import "MSUProgramDetailView.h"


#import "MSUPathTools.h"
#import "MSUStringTools.h"

@implementation MSUProgramDetailView

- (instancetype)initWithFrame:(CGRect)frame
{
    if (self = [super initWithFrame:frame]) {
        
        self.cicleViewArr = [NSMutableArray array];
        self.textArr = [NSMutableArray array];

        [self createView];
        
    }
    return self;
}


- (void)createView{
    /// 项目介绍
    UIView *orangeView = [[UIView alloc] init];
    orangeView.frame = CGRectMake(0, 15.5*kDeviceHeightScale, 4*kDeviceWidthScale, 15*kDeviceHeightScale);
    orangeView.backgroundColor = titOrangeColor;
    [self addSubview:orangeView];
    
    UILabel *introLab = [[UILabel alloc] init];
    introLab.frame = CGRectMake(orangeView.right + 16*kDeviceWidthScale, 12*kDeviceHeightScale, 70*kDeviceWidthScale, 22.5*kDeviceHeightScale);
    introLab.text = @"项目介绍";
    introLab.font = [UIFont systemFontOfSize:16];
    introLab.textColor = titBlackColor;
    [self addSubview:introLab];


    self.introDetailLab = [[UILabel alloc] init];
    _introDetailLab.frame = CGRectMake(16*kDeviceWidth, 49*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, 88*kDeviceHeightScale);
    _introDetailLab.font = [UIFont systemFontOfSize:14];
    _introDetailLab.textColor = titBlackQianColor;
    _introDetailLab.numberOfLines = 0;
    [self addSubview:_introDetailLab];

    self.lineView = [[UIView alloc] init];
    _lineView.frame = CGRectMake(0, _introDetailLab.bottom, kDeviceWidth, 13*kDeviceHeightScale);
    _lineView.backgroundColor = BGWhiteColor;
    [self addSubview:_lineView];

    
    
    /// 项目进度
    self.progressView = [[UIView alloc] init];
    _progressView.frame = CGRectMake(0, _lineView.bottom, kDeviceWidth, 32*kDeviceHeightScale);
    _progressView.backgroundColor = HEXCOLOR(0xffffff);
    [self addSubview:_progressView];
    
    UIView *orangeView1 = [[UIView alloc] init];
    orangeView1.frame = CGRectMake(0,15.5*kDeviceHeightScale, 4*kDeviceWidthScale, 15*kDeviceHeightScale);
    orangeView1.backgroundColor = titOrangeColor;
    [_progressView addSubview:orangeView1];

    
    UILabel *progressLab = [[UILabel alloc] init];
    progressLab.frame = CGRectMake(orangeView1.right + 16*kDeviceWidthScale, 12*kDeviceHeightScale, 70*kDeviceWidthScale, 22.5*kDeviceHeightScale);
    progressLab.text = @"项目进度";
    progressLab.font = [UIFont systemFontOfSize:16];
    progressLab.textColor = titBlackColor;
    [_progressView addSubview:progressLab];

    
    NSArray *arr = @[@"今日投资",@"等待满标",@"次日计息",@"投资期满",@"到账余额"];
    for (NSInteger i = 0; i < arr.count; i++) {
        UILabel *menuLab = [[UILabel alloc] init];
        menuLab.frame = CGRectMake(10.5*kDeviceWidthScale + (54+22)*kDeviceWidthScale*i, progressLab.bottom+ 19.5*kDeviceHeightScale, 54*kDeviceWidthScale, 18.5*kDeviceHeightScale);
        menuLab.text = arr[i];
        menuLab.font = [UIFont systemFontOfSize:13];
        menuLab.textColor = titBlackQianColor;
        [_progressView addSubview:menuLab];

        
        UIView *bgView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 9.5*kDeviceWidthScale, 9.5*kDeviceWidthScale)];
        bgView.center = CGPointMake(menuLab.center.x, menuLab.bottom+8*kDeviceHeightScale);
        bgView.clipsToBounds = YES;
        bgView.layer.cornerRadius = 9.5*kDeviceWidthScale*0.5;
        bgView.layer.shouldRasterize = YES;
        bgView.layer.rasterizationScale = [UIScreen mainScreen].scale;
        bgView.layer.borderColor = titOrangeColor.CGColor;
        bgView.layer.borderWidth = 1;
        [_progressView addSubview:bgView];

        
        UIImageView *imaView = [[UIImageView alloc] initWithFrame:CGRectMake(bgView.right, bgView.top, 67*kDeviceWidthScale, 9.5*kDeviceWidthScale)];//
        imaView.image = [MSUPathTools showImageWithContentOfFileByName:@"xmjd_icon"];
        if (i == 4) {
            imaView.image = nil;
        }
        [_progressView addSubview:imaView];
        
        UILabel *dateLab = [[UILabel alloc] init];
        dateLab.frame = CGRectMake(6.5*kDeviceWidthScale + (66+10)*kDeviceWidthScale*i, bgView.bottom+ 8*kDeviceHeightScale, 66*kDeviceWidthScale, 16.5*kDeviceHeightScale);
        dateLab.text = @"2017.11.24";
        dateLab.font = [UIFont systemFontOfSize:12];
        dateLab.textAlignment = NSTextAlignmentCenter;
        dateLab.textColor = titLightColor;
        [_progressView addSubview:dateLab];
        if (i == 4) {
            dateLab.text = @"申请提现";
        } else{
            [self.cicleViewArr addObject:dateLab];
        }

    }
    
    UILabel *yuLab = [[UILabel alloc] init];
    yuLab.frame = CGRectMake(85*kDeviceWidthScale,progressLab.bottom + 80*kDeviceHeightScale, 56.5*kDeviceWidthScale, 16.5*kDeviceHeightScale);
    yuLab.text = @"预计";
    yuLab.font = [UIFont systemFontOfSize:12];
    yuLab.textColor = titLightColor;
    yuLab.textAlignment = NSTextAlignmentCenter;
    [_progressView addSubview:yuLab];
    
    
    UILabel *centerLab = [[UILabel alloc] init];
    centerLab.frame = CGRectMake(kDeviceWidth*0.5-70*kDeviceWidthScale,yuLab.bottom + 10*kDeviceHeightScale, 140*kDeviceWidthScale, 16.5*kDeviceHeightScale);
    centerLab.text = @"具体日期以实际日期为准";
    centerLab.font = [UIFont systemFontOfSize:12];
    centerLab.textColor = titLightColor;
    centerLab.textAlignment = NSTextAlignmentCenter;
    [_progressView addSubview:centerLab];
    
    UIView *rightlineView = [[UIView alloc] init];
    rightlineView.frame = CGRectMake(centerLab.right, yuLab.bottom+18*kDeviceHeightScale, kDeviceWidth*0.5-77*kDeviceWidthScale, 1*kDeviceHeightScale);
    rightlineView.backgroundColor = HEXCOLOR(0xe2e2e2);
    [_progressView addSubview:rightlineView];

    UIView *leftlineView = [[UIView alloc] init];
    leftlineView.frame = CGRectMake(10*kDeviceWidthScale, yuLab.bottom+18*kDeviceHeightScale, kDeviceWidth*0.5-77*kDeviceWidthScale, 1*kDeviceHeightScale);
    leftlineView.backgroundColor = HEXCOLOR(0xe2e2e2);
    [_progressView addSubview:leftlineView];

    self.lineView1 = [[UIView alloc] init];
    _lineView1.frame = CGRectMake(0, _lineView.bottom + 169.5*kDeviceHeightScale, kDeviceWidth, 13*kDeviceHeightScale);
    _lineView1.backgroundColor = BGWhiteColor;
    [self addSubview:_lineView1];

    
    /// 借款描述
    self.describeView = [[UIView alloc] init];
    _describeView.frame = CGRectMake(0, _lineView1.bottom, kDeviceWidth, (34.5+32+28*2)*kDeviceHeightScale);
    _describeView.backgroundColor = HEXCOLOR(0xffffff);
    [self addSubview:_describeView];
    
    UIView *orange2View = [[UIView alloc] init];
    orange2View.frame = CGRectMake(0, 15.5*kDeviceHeightScale, 4*kDeviceWidthScale, 15*kDeviceHeightScale);
    orange2View.backgroundColor = titOrangeColor;
    [_describeView addSubview:orange2View];

    
    UILabel *describeLab = [[UILabel alloc] init];
    describeLab.frame = CGRectMake(orange2View.right + 16*kDeviceWidthScale,12*kDeviceHeightScale, 70*kDeviceWidthScale, 22.5*kDeviceHeightScale);
    describeLab.text = @"借款描述";
    describeLab.font = [UIFont systemFontOfSize:16];
    describeLab.textColor = titBlackColor;
    [_describeView addSubview:describeLab];

    
    self.describeDetailLab = [[UILabel alloc] init];
    _describeDetailLab.frame = CGRectMake(16*kDeviceWidthScale, describeLab.bottom+12*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, 20*kDeviceHeightScale);
    _describeDetailLab.font = [UIFont systemFontOfSize:14];
    _describeDetailLab.textColor = titBlackQianColor;
    _describeDetailLab.numberOfLines = 0;
    [_describeView addSubview:_describeDetailLab];
    
    self.moneyLab = [[UILabel alloc] init];
    _moneyLab.frame = CGRectMake(16*kDeviceWidthScale, _describeDetailLab.bottom+8*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, 20*kDeviceHeightScale);
    _moneyLab.font = [UIFont systemFontOfSize:14];
    _moneyLab.textColor = titBlackQianColor;
    _moneyLab.numberOfLines = 0;
    [_describeView addSubview:_moneyLab];
    
    self.numLab = [[UILabel alloc] init];
    _numLab.frame = CGRectMake(16*kDeviceWidthScale, _moneyLab.bottom+8*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, 20*kDeviceHeightScale);
    _numLab.font = [UIFont systemFontOfSize:14];
    _numLab.textColor = titBlackQianColor;
    _numLab.numberOfLines = 0;
    [_describeView addSubview:_numLab];
    
//    self.describeDetailView = [[UIImageView alloc] init];
//    _describeDetailView.frame = CGRectMake(16*kDeviceWidthScale, _describeDetailLab.bottom+12.5*kDeviceHeightScale, kDeviceWidth, 65*kDeviceHeightScale);
//    _describeDetailView.backgroundColor = HEXCOLOR(0xffffff);
//    [_describeView addSubview:_describeDetailView];
    
    self.lineView2 = [[UIView alloc] init];
    _lineView2.frame = CGRectMake(0, _describeView.bottom+3*kDeviceHeightScale, kDeviceWidth, 13*kDeviceHeightScale);
    _lineView2.backgroundColor = BGWhiteColor;
    [self addSubview:_lineView2];
    
    /// 风控信息
    self.informationView = [[UIView alloc] init];
    _informationView.frame = CGRectMake(0, _lineView2.bottom, kDeviceWidth, 32*kDeviceHeightScale);
    _informationView.backgroundColor = HEXCOLOR(0xffffff);
    [self addSubview:_informationView];
    
    UIView *orange3View = [[UIView alloc] init];
    orange3View.frame = CGRectMake(0, 15.5*kDeviceHeightScale, 4*kDeviceWidthScale, 15*kDeviceHeightScale);
    orange3View.backgroundColor = titOrangeColor;
    [_informationView addSubview:orange3View];
    
    
    UILabel *infoLab = [[UILabel alloc] init];
    infoLab.frame = CGRectMake(orange3View.right + 16*kDeviceWidthScale,12*kDeviceHeightScale, 70*kDeviceWidthScale, 22.5*kDeviceHeightScale);
    infoLab.text = @"风控信息";
    infoLab.font = [UIFont systemFontOfSize:16];
    infoLab.textColor = titBlackColor;
    [_informationView addSubview:infoLab];

    self.companyLab = [[UILabel alloc] init];
    _companyLab.frame = CGRectMake(16*kDeviceWidthScale, infoLab.bottom+12*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale,20*kDeviceHeightScale);
    _companyLab.font = [UIFont systemFontOfSize:14];
    _companyLab.textColor = titBlackQianColor;
    _companyLab.numberOfLines = 0;
    [_informationView addSubview:_companyLab];
    
    self.informationLab = [[UILabel alloc] init];
    _informationLab.frame = CGRectMake(16*kDeviceWidthScale, _companyLab.bottom+8*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, 88*kDeviceHeightScale);
    _informationLab.font = [UIFont systemFontOfSize:14];
    _informationLab.textColor = titBlackQianColor;
    _informationLab.numberOfLines = 0;
    [_informationView addSubview:_informationLab];

    self.lineView3 = [[UIView alloc] init];
    _lineView3.frame = CGRectMake(0, _informationView.bottom, kDeviceWidth, 13*kDeviceHeightScale);
    _lineView3.backgroundColor = BGWhiteColor;
    [self addSubview:_lineView3];
    
    // 财产保险

    self.lastView = [[UIView alloc] init];
    _lastView.frame = CGRectMake(0, _lineView3.bottom, kDeviceWidth, (34.5+12)*kDeviceHeightScale);
    _lastView.backgroundColor = HEXCOLOR(0xffffff);
    [self addSubview:_lastView];
    
    UIView *orange4View = [[UIView alloc] init];
    orange4View.frame = CGRectMake(0, 15.5*kDeviceHeightScale, 4*kDeviceWidthScale, 15*kDeviceHeightScale);
    orange4View.backgroundColor = titOrangeColor;
    [_lastView addSubview:orange4View];
    
    
    UILabel *lastLab = [[UILabel alloc] init];
    lastLab.frame = CGRectMake(orange4View.right + 16*kDeviceWidthScale,12*kDeviceHeightScale, 70*kDeviceWidthScale, 22.5*kDeviceHeightScale);
    lastLab.text = @"财产保险";
    lastLab.font = [UIFont systemFontOfSize:16];
    lastLab.textColor = titBlackColor;
    [_lastView addSubview:lastLab];
    
    self.lastLab = [[UILabel alloc] init];
    _lastLab.font = [UIFont systemFontOfSize:14];
    _lastLab.frame = CGRectMake(16*kDeviceWidthScale, 46.5*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, 20*kDeviceHeightScale);
    _lastLab.textColor = titBlackQianColor;
    _lastLab.numberOfLines = 0;
    [_lastView addSubview:_lastLab];
    
    // 图片
    self.describeDetailBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    _describeDetailBtn.frame = CGRectMake(16*kDeviceWidthScale, _lastView.bottom+12.5*kDeviceHeightScale, kDeviceWidth, 65*kDeviceHeightScale);
    [self addSubview:_describeDetailBtn];
    [_describeDetailBtn addTarget:self action:@selector(describeDetailBtnClick:) forControlEvents:UIControlEventTouchUpInside];
}

- (void)describeDetailBtnClick:(UIButton *)sender{
    [UIView animateWithDuration:0.25 animations:^{
        self.shadowView.hidden = NO;
        self.imaSView.hidden = NO;
        
        NSDictionary *dic = _imaArr[0];
        [_imaSView sd_setImageWithURL:[NSURL URLWithString:dic[@"borrowImageUrl"]]];
    }];
    
}


- (void)setDataArr:(NSArray *)dataArr{
    _dataArr = dataArr;
    
    //项目介绍
    _introDetailLab.text = _dataArr[0];
    CGRect recta = [MSUStringTools danamicGetHeightFromText:_introDetailLab.text WithWidth:kDeviceWidth-32*kDeviceWidthScale font:14];
    _introDetailLab.frame = CGRectMake(16*kDeviceWidthScale, 49*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, recta.size.height);
    [MSUStringTools changeLineSpaceForLabel:_introDetailLab WithSpace:5.0];

    //项目进度
    _lineView.frame = CGRectMake(0, _introDetailLab.bottom+8*kDeviceHeightScale, kDeviceWidth, 13*kDeviceHeightScale);
    _progressView.frame = CGRectMake(0, _lineView.bottom, kDeviceWidth, 32*kDeviceHeightScale);
    _lineView1.frame = CGRectMake(0, _lineView.bottom + 169.5*kDeviceHeightScale, kDeviceWidth, 13*kDeviceHeightScale);

    //借款描述
    _describeView.frame = CGRectMake(0, _lineView1.bottom, kDeviceWidth, (34.5+32+28*2+5)*kDeviceHeightScale);
    _lineView2.frame = CGRectMake(0, _describeView.bottom+5*kDeviceHeightScale, kDeviceWidth, 13*kDeviceHeightScale);

    _describeDetailLab.text = [NSString stringWithFormat:@"承兑银行 : %@元",_dataArr[1]];
//    CGRect rectb = [MSUStringTools danamicGetHeightFromText:_describeDetailLab.text WithWidth:kDeviceWidth-32*kDeviceWidthScale font:14];
//    _describeDetailLab.frame = CGRectMake(16*kDeviceWidthScale,46.5*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, rectb.size.height);
//    [MSUStringTools changeLineSpaceForLabel:_describeDetailLab WithSpace:5.0];
    _moneyLab.text = [NSString stringWithFormat:@"票面金额 : %@元",_dataArr[2]];
    _numLab.text = [NSString stringWithFormat:@"票   号 : %@",_dataArr[3]];

    //风控信息
    _companyLab.text = [NSString stringWithFormat:@"保理公司 : %@元",_dataArr[4]];
    _informationLab.text = [NSString stringWithFormat:@"还款来源 : %@",_dataArr[5]];
    CGRect rectc = [MSUStringTools danamicGetHeightFromText:_informationLab.text WithWidth:kDeviceWidth-32*kDeviceWidthScale font:14];
    _informationLab.frame = CGRectMake(16*kDeviceWidthScale, _companyLab.bottom+8*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, rectc.size.height);
    [MSUStringTools changeLineSpaceForLabel:_informationLab WithSpace:5.0];

    _informationView.frame = CGRectMake(0, _lineView2.bottom, kDeviceWidth, (34.5+32+8+15)*kDeviceHeightScale+rectc.size.height);
    _lineView3.frame = CGRectMake(0, _informationView.bottom, kDeviceWidth, 13*kDeviceHeightScale);

    //财产保险
    _lastLab.text = @"拟与中国人民财产保险公司战略合作,为平台所有投资人投保财产险";
    CGRect rectAA = [MSUStringTools danamicGetHeightFromText:_lastLab.text WithWidth:kDeviceWidth-32*kDeviceWidthScale font:14];
    _lastLab.frame = CGRectMake(16*kDeviceWidthScale, 46.5*kDeviceHeightScale, kDeviceWidth-32*kDeviceWidthScale, rectAA.size.height);
    _lastView.frame = CGRectMake(0, _lineView3.bottom, kDeviceWidth, (34.5+12)*kDeviceHeightScale+rectAA.size.height);

}

- (void)setDateArr:(NSArray *)dateArr{
    _dateArr = dateArr;
    
    NSDictionary *dic = _dateArr[0];
    NSMutableArray *muArr = [NSMutableArray array];
    [muArr addObject:dic[@"todayDate"]];
    [muArr addObject:dic[@"fillData"]];
    [muArr addObject:dic[@"nextDate"]];
    [muArr addObject:dic[@"moneyDate"]];

    for (NSInteger i = 0; i < _cicleViewArr.count; i++) {
        UILabel *lab = _cicleViewArr[i];
        lab.text = muArr[i];
    }
}

- (void)setImaArr:(NSArray *)imaArr{
    _imaArr = imaArr;
    NSDictionary *dic = _imaArr[0];
    
    [_describeDetailBtn sd_setImageWithURL:[NSURL URLWithString:dic[@"borrowImageUrl"]] forState:UIControlStateNormal];
//    [_describeDetailView sd_setImageWithURL:[NSURL URLWithString:dic[@"borrowImageUrl"]]];
//    _describeDetailView.frame = CGRectMake(16*kDeviceWidthScale, _describeDetailLab.bottom+12.5*kDeviceHeightScale, 130*kDeviceWidthScale, 65*kDeviceHeightScale);
    _describeDetailBtn.frame = CGRectMake(16*kDeviceWidthScale, _lastView.bottom+12.5*kDeviceHeightScale, 130*kDeviceWidthScale, 65*kDeviceHeightScale);

}


- (MSUShadowInView *)shadowView{
    if (!_shadowView) {
        _shadowView = [[MSUShadowInView alloc] initWithFrame:CGRectMake(0, 0, kDeviceWidth, kDeviceHeight)];
        _shadowView.backgroundColor = [UIColor colorWithRed:0 green:0 blue:0 alpha:0.7];
        [MSUMainWindow addSubview:_shadowView];
        _shadowView.hidden = YES;
    }
    return _shadowView;
}

- (UIImageView *)imaSView{
    if (!_imaSView) {
        _imaSView = [[UIImageView alloc] initWithFrame:CGRectMake(0, kDeviceHeight*0.5-100*kDeviceHeightScale, kDeviceWidth, 200*kDeviceHeightScale)];
        [self.shadowView addSubview:_imaSView];
    }
    return _imaSView;
}

@end
